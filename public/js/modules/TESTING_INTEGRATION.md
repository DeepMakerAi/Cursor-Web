# 测试功能整合说明

## 📋 整合概述

所有测试页面已统一整合到 `diagnostic.html` 诊断页面中，提供一站式的系统诊断和测试功能。

## 🔧 整合的测试功能

### 1. **基础模块诊断**
- **模块加载器检查** - 检查所有模块的加载状态
- **错误处理器测试** - 测试错误捕获和处理机制
- **WebSocket管理器测试** - 检查连接状态和重连功能
- **内容管理器检查** - 验证内容同步功能
- **状态管理器检查** - 检查状态监控功能
- **UI管理器测试** - 测试界面更新功能
- **事件管理器检查** - 验证事件绑定和处理
- **调试管理器** - 获取系统调试信息

### 2. **Cursor状态管理测试**
- **Cursor状态检查** - 检查Cursor应用状态
- **模拟Cursor活动** - 模拟Cursor内容更新
- **模拟Cursor关闭** - 模拟Cursor应用关闭
- **状态描述获取** - 获取详细的状态描述

### 3. **首页状态管理测试**
- **首页状态检查** - 检查首页显示的状态
- **强制状态更新** - 强制刷新首页状态显示
- **状态同步测试** - 测试状态变化同步

### 4. **WebSocket连接测试**
- **连接状态测试** - 检查WebSocket连接状态
- **手动断开测试** - 测试手动断开连接
- **重连功能测试** - 测试自动重连机制

### 5. **消息发送测试**
- **测试消息发送** - 发送测试消息
- **消息输入测试** - 测试消息输入功能

## 🎯 新增的测试模块

### **Cursor状态管理器**
```javascript
// 检查Cursor状态
checkCursorStatus()

// 模拟Cursor活动
simulateCursorActivity()

// 模拟Cursor关闭
simulateCursorClose()
```

### **首页状态管理器**
```javascript
// 检查首页状态
checkHomePageStatus()

// 强制更新状态
forceUpdateHomeStatus()
```

### **状态同步测试**
```javascript
// 测试状态同步
testStatusSync()

// 打开状态同步测试页面
openStatusSyncTest()
```

### **WebSocket连接测试**
```javascript
// 测试WebSocket连接
testWebSocketConnection()

// 测试断开连接
testDisconnect()
```

### **消息发送测试**
```javascript
// 发送测试消息
sendTestMessage()

// 测试消息输入
testMessageInput()
```

## 🗂️ 删除的独立测试页面

以下测试页面已被删除，功能已整合到诊断页面：

- `connection-test.html` - WebSocket连接测试
- `status-sync-test.html` - 状态同步测试
- `separated-status.html` - 分离状态显示测试
- `cursor-status-test.html` - Cursor状态测试

## 📊 首页快速状态检查

首页诊断标签页现在包含：

- **WebSocket连接状态** - 实时显示连接状态
- **Cursor状态** - 显示Cursor应用状态（活跃/等待/不活跃/已关闭）
- **模块加载状态** - 检查模块加载情况
- **客户端状态** - 检查客户端初始化状态

## 🔍 使用方法

### 1. **打开诊断页面**
在首页点击"系统诊断"标签，然后点击"🔍 打开完整诊断页面"

### 2. **运行完整诊断**
点击"🚀 开始诊断"按钮，系统会自动：
- 检查模块加载器
- 加载所有模块
- 初始化客户端
- 运行完整诊断

### 3. **单独测试功能**
点击各个模块卡片上的测试按钮：
- **检查** - 检查模块状态
- **测试** - 运行功能测试
- **模拟** - 模拟特定场景

### 4. **查看诊断日志**
诊断页面底部显示详细的诊断日志，包含：
- 时间戳
- 操作类型（信息/成功/警告/错误）
- 详细描述

## 🎨 界面特性

### **状态指示器**
- 🟢 **绿色** - 正常/成功
- 🟡 **黄色** - 警告/等待
- 🔴 **红色** - 错误/失败
- 🔵 **蓝色** - 信息/连接中

### **模块卡片**
每个模块都有独立的卡片，显示：
- 模块名称和状态指示器
- 当前状态描述
- 可用的测试按钮

### **实时更新**
- 状态变化实时反映在界面上
- 自动更新模块状态
- 定期检查系统状态

## 📝 调试命令

诊断页面还提供全局调试命令：

```javascript
// 检查首页状态
checkHomePageStatus()

// 获取完整状态
getFullStatus()

// 模拟Cursor活动
simulateCursorActivity()

// 模拟Cursor关闭
simulateCursorClose()

// 测试WebSocket连接
testWebSocketConnection()

// 测试断开连接
testDisconnect()
```

## 🔄 状态同步

诊断页面支持跨页面状态同步：
- 使用localStorage进行状态广播
- 多个标签页状态自动同步
- 实时状态更新

## 📤 日志导出

诊断页面支持：
- **清除日志** - 清空当前日志
- **导出日志** - 下载日志文件
- **导出调试数据** - 下载JSON格式的调试数据

## 🎯 测试场景

### **正常使用场景**
1. 打开诊断页面
2. 运行完整诊断
3. 检查所有模块状态为绿色
4. 测试Cursor状态管理功能

### **网络问题场景**
1. 断开网络连接
2. 观察WebSocket状态变为红色
3. 恢复网络连接
4. 观察自动重连功能

### **Cursor关闭场景**
1. 模拟Cursor关闭
2. 观察Cursor状态变为"已关闭"
3. 模拟Cursor活动
4. 观察状态恢复为"活跃"

## 🚀 性能优化

- **模块化加载** - 按需加载测试功能
- **状态缓存** - 避免重复状态检查
- **异步操作** - 非阻塞的测试执行
- **内存管理** - 及时清理测试资源

## 🔧 维护说明

### **添加新测试功能**
1. 在诊断页面添加新的模块卡片
2. 实现对应的测试函数
3. 更新完整诊断流程
4. 添加相应的文档说明

### **修改现有测试**
1. 更新对应的测试函数
2. 确保状态指示器正确显示
3. 更新日志输出格式
4. 测试功能完整性

### **删除测试功能**
1. 移除模块卡片
2. 删除测试函数
3. 更新依赖关系
4. 清理相关文档

---

**注意**：所有测试功能现在都集中在诊断页面中，便于统一管理和维护。如需添加新的测试功能，请遵循上述规范。
